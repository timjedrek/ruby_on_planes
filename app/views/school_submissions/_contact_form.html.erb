<div data-controller="nested-form">
  <template data-nested-form-target="template">
    <div class="nested-fields border rounded-lg p-4 mb-4 relative" data-new-record="true" data-index="NEW_RECORD">
      <input type="hidden" name="<%= form_name %>[contact_people_attributes][NEW_RECORD][_destroy]" value="0" class="destroy-field">
      
      <div class="absolute top-2 right-2">
        <a href="#" class="text-red-600 hover:text-red-800" data-action="click->nested-form#remove">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </a>
      </div>

      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
        <div>
          <label class="block text-sm font-medium text-gray-700">Name</label>
          <input type="text" name="<%= form_name %>[contact_people_attributes][NEW_RECORD][name]" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" required>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Title</label>
          <input type="text" name="<%= form_name %>[contact_people_attributes][NEW_RECORD][title]" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Email</label>
          <input type="email" name="<%= form_name %>[contact_people_attributes][NEW_RECORD][email]" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Phone</label>
          <input type="tel" name="<%= form_name %>[contact_people_attributes][NEW_RECORD][phone]" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
        </div>
      </div>
    </div>
  </template>

  <div data-nested-form-target="container">
    <% contacts = form_obj.contact_people %>
    <% if contacts.empty? %>
      <% contacts = [ContactPerson.new] %>
    <% end %>
    
    <% contacts.each_with_index do |contact, index| %>
      <div class="nested-fields border rounded-lg p-4 mb-4 relative" data-new-record="<%= contact.new_record? %>" data-index="<%= index %>">
        <input type="hidden" name="<%= form_name %>[contact_people_attributes][<%= index %>][_destroy]" value="0" class="destroy-field">
        <% if contact.persisted? %>
          <input type="hidden" name="<%= form_name %>[contact_people_attributes][<%= index %>][id]" value="<%= contact.id %>">
        <% end %>
        
        <div class="absolute top-2 right-2">
          <a href="#" class="text-red-600 hover:text-red-800" data-action="click->nested-form#remove">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </a>
        </div>

        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
          <div>
            <label class="block text-sm font-medium text-gray-700">Name</label>
            <input type="text" name="<%= form_name %>[contact_people_attributes][<%= index %>][name]" value="<%= contact.name %>" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Title</label>
            <input type="text" name="<%= form_name %>[contact_people_attributes][<%= index %>][title]" value="<%= contact.title %>" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Email</label>
            <input type="email" name="<%= form_name %>[contact_people_attributes][<%= index %>][email]" value="<%= contact.email %>" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700">Phone</label>
            <input type="tel" name="<%= form_name %>[contact_people_attributes][<%= index %>][phone]" value="<%= contact.phone %>" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <div class="mt-4" data-nested-form-target="add_item">
    <a href="#" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" data-action="click->nested-form#add">
      <svg class="-ml-1 mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
      </svg>
      Add Another Contact Person
    </a>
  </div>
</div> 